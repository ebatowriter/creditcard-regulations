# クレジットカードSEO記事修正ツール

## プロジェクト概要

クレジットカードメディアのSEO記事を、ガイドラインとレギュレーションに基づいて自動修正するWebアプリケーションです。

- **対象カード**: JCB、ACマスターカード、楽天カード
- **技術スタック**: Hono + TypeScript + TailwindCSS + OpenAI API
- **デプロイ**: Cloudflare Pages

## 機能一覧

### ✅ 完成済み機能

1. **パスワード認証システム**
   - パスワード: `0908`
   - セッション管理

2. **テキスト修正機能**
   - プレーンテキストの内容を修正
   - JCB、ACマスターカード、楽天カード関連のみ修正
   - その他のカードは一切変更なし

3. **HTML修正機能**
   - HTMLコードの内容を修正
   - デザイン・構造・クラス名は完全保持
   - テキストコンテンツのみを修正
   - プレビュー機能付き
   - **画像URL・リンクURL完全保持機能**

4. **ガイドライン設定機能**
   - 各カードごとのガイドライン管理
   - ローカルストレージに保存
   - 修正時に自動適用
   - **JCBガイドライン完全統合済み（14項目チェックリスト対応）**

5. **OpenAI統合**
   - GPT-4oを使用した高精度修正
   - APIキーは環境変数で管理
   - エラーハンドリング実装済み
   - **詳細プロンプト設計（JCBガイドライン完全準拠）**

### 🎯 JCBガイドライン対応状況

**✅ 完全実装済み（14項目すべて対応）**

1. ✅ ポイント・還元率表記（※付与、J-POINT統一）
2. ✅ 年会費表記（税込明記）
3. ✅ 対象年齢表記（W: 18～39歳、S: 制限なし）
4. ✅ 発行スピード表記（モバ即対応表現）
5. ✅ 審査・在籍確認表記（中立表現）
6. ✅ 付帯保険表記（正確な金額）
7. ✅ ブランド・商標表記（Amazon.co.jp※2等）
8. ✅ パートナー店表記（J-POINTパートナー店）
9. ✅ アクセシビリティ（alt、aria-label）
10. ✅ 注釈・出典要件（注釈エリア新設）
11. ✅ **画像・リンクURL保持（絶対変更禁止機能）**
12. ✅ 禁止表現チェック
13. ✅ 推奨表現適用
14. ✅ 他カード完全保持（三井住友・楽天等は変更なし）

### 🎯 ACマスターカードガイドライン対応状況

**✅ 完全実装済み（10項目すべて対応）**

1. ✅ 絶対禁止表現チェック（審査が甘い、通りやすい等）
2. ✅ 必須指定表記（審査時間、在籍確認、自動契約機）
3. ✅ 貸付条件（必須記載事項・最新金利2.4%~17.9%）
4. ✅ 会社情報（最新登録番号(15)、住所更新）
5. ✅ ステルスマーケティング表記（必須）
6. ✅ CTAリンク遷移先（公式サイトへの誘導）
7. ✅ 許容表現適用（独自の審査基準等）
8. ✅ 禁止記事コンセプトチェック（ブラックリスト関連等）
9. ✅ **画像・リンクURL保持（絶対変更禁止機能）**
10. ✅ 他カード完全保持（三井住友・楽天等は変更なし）

## URLs

- **開発環境**: https://3000-ilbxtz6nh2o21hj438xc4-de59bda9.sandbox.novita.ai
- **GitHub**: （未設定）
- **本番環境**: （未デプロイ）

## 使い方

### 1. ログイン
- パスワード `0908` を入力してログイン

### 2. ガイドライン設定
1. 「ガイドライン設定」タブを開く
2. 各カードのガイドラインを入力
3. 「保存」をクリック

### 3. テキスト修正
1. 「テキスト修正」タブを開く
2. 修正したいテキストを入力
3. 「修正を実行」をクリック
4. 修正結果をコピー

### 4. HTML修正
1. 「HTML修正」タブを開く
2. 修正したいHTMLコードを入力
3. 「修正を実行」をクリック
4. 「プレビュー」で確認
5. 修正結果をコピー

## データアーキテクチャ

### ストレージ
- **ローカルストレージ**: ガイドライン設定（ブラウザ側）
- **環境変数**: OpenAI APIキー、パスワード

### API構成
- `POST /api/login` - 認証
- `POST /api/correct-text` - テキスト修正
- `POST /api/correct-html` - HTML修正

### OpenAI統合
- モデル: `gpt-4o`
- Temperature: 0.3（一貫性重視）
- Max Tokens: 4000（テキスト）、8000（HTML）

## 開発環境セットアップ

### 必要なもの
- Node.js 18+
- npm

### ローカル開発

```bash
# 依存関係のインストール
npm install

# ビルド
npm run build

# 開発サーバー起動（PM2）
pm2 start ecosystem.config.cjs

# 動作確認
curl http://localhost:3000

# ログ確認
pm2 logs webapp --nostream

# サービス停止
pm2 delete webapp
```

### 環境変数設定

`.dev.vars` ファイルを作成（ローカル開発用）:
```bash
OPENAI_API_KEY=sk-proj-...
APP_PASSWORD=0908
```

**注意**: `.dev.vars` は `.gitignore` に含まれており、Gitにコミットされません。

## デプロイ

### Cloudflare Pagesへのデプロイ

```bash
# ビルド
npm run build

# デプロイ
npm run deploy

# 本番環境の環境変数設定
wrangler pages secret put OPENAI_API_KEY --project-name webapp
wrangler pages secret put APP_PASSWORD --project-name webapp
```

## プロジェクト構造

```
webapp/
├── src/
│   └── index.tsx              # Honoバックエンド（認証・API）
├── public/
│   └── static/
│       └── app.js             # フロントエンドロジック
├── dist/                      # ビルド出力
├── .dev.vars                  # ローカル環境変数（Git除外）
├── ecosystem.config.cjs       # PM2設定
├── wrangler.jsonc            # Cloudflare設定
├── package.json              # 依存関係とスクリプト
└── README.md                 # このファイル
```

## ガイドライン設定について

### ✅ JCBカード ガイドライン（設定済み）

**JCBカードのガイドラインは既に完全統合されています。**

アプリケーション起動時に自動的にデフォルト設定が読み込まれます。

#### 対応項目（14項目チェックリスト）

1. ポイント・還元率表記（※付与、注釈必須）
2. ポイント名称統一（Oki Dokiポイント → J-POINT）
3. 年会費表記（税込明記）
4. 対象年齢表記（W: 18～39歳限定、S: 年齢制限なし）
5. 発行スピード表記（モバ即対応、断定表現禁止）
6. 審査表記（中立表現、誇大広告禁止）
7. 付帯保険表記（W・S: 最高2,000万円、ゴールド: 最高1億円）
8. ブランド・商標表記（Amazon.co.jp、セブン‐イレブン等）
9. パートナー店表記（J-POINTパートナー店統一）
10. アクセシビリティ（alt属性、aria-label必須）
11. 注釈エリア新設（JCB公式サイトリンク含む）
12. **画像URL完全保持（iwataworks.jp URLは変更禁止）**
13. **リンクURL完全保持（CTAリンクは変更禁止）**
14. 他カード保持（三井住友、楽天等は修正対象外）

### ✅ ACマスターカード ガイドライン（設定済み）

**ACマスターカードのガイドラインは既に完全統合されています。**

アプリケーション起動時に自動的にデフォルト設定が読み込まれます。

#### 対応項目（10項目チェックリスト）

1. 絶対禁止表現チェック（審査が甘い、通りやすい、ブラックでも等）
2. 必須指定表記
   - 審査時間: 最短20分※（注釈必須）
   - 在籍確認: 原則、お勤め先へ在籍確認の電話なし※（注釈必須）
   - 自動契約機: 自動契約機(むじんくん)（半角括弧必須）
3. 貸付条件（必須記載・最新金利2.4%~17.9%）
4. 会社情報（最新登録番号(15)、住所更新）
5. ステルスマーケティング表記（記事冒頭に必須）
6. CTAリンク遷移先（公式サイトhttps://www.acom.co.jp/lineup/credit/）
7. 許容表現適用（独自の審査基準、審査が早い等）
8. 禁止記事コンセプトチェック（ブラックリスト関連記事等）
9. **画像URL完全保持（iwataworks.jp URLは変更禁止）**
10. **リンクURL完全保持（CTAリンクは変更禁止）**

#### 確認・編集方法

1. アプリケーションにログイン
2. 「ガイドライン設定」タブを開く
3. JCB・ACマスターカードガイドラインを確認・必要に応じて編集
4. 「保存」をクリック

### 🔜 後から設定する項目

以下のガイドラインは、後からアプリケーション内で設定してください：

1. **楽天カード ガイドライン**
   - 楽天カードに関する表記ルール
   - 修正基準
   - 注意事項
   - 修正基準
   - 注意事項
   - 修正基準
   - 注意事項

### ガイドライン例

```
## 表記ルール
- 正式名称を使用する
- ×「JCBカード」→ ○「JCBオリジナルシリーズ」

## 禁止事項
- 誤解を招く表現は使用しない
- 古い情報を掲載しない

## SEO最適化
- キーワードを自然に含める
- 読みやすい文章にする
```

## トラブルシューティング

### OpenAI APIエラー
- `.dev.vars` のAPIキーが正しいか確認
- APIキーの使用量制限を確認
- ネットワーク接続を確認

### ビルドエラー
```bash
# node_modulesを再インストール
rm -rf node_modules package-lock.json
npm install
npm run build
```

### ポート競合
```bash
# ポート3000を解放
npm run clean-port
# または
fuser -k 3000/tcp
```

## セキュリティ

- OpenAI APIキーは環境変数で管理
- `.dev.vars` はGitから除外
- パスワード認証は本番環境では必ず変更してください
- 本番デプロイ時は `wrangler pages secret` を使用

## ライセンス

このプロジェクトは内部使用のために開発されました。

## 今後の拡張予定

- [ ] 楽天カードガイドラインの統合
- [ ] ガイドラインのインポート/エクスポート機能
- [ ] 修正履歴の保存機能
- [ ] 一括修正機能（複数ファイル対応）
- [ ] カスタムプロンプトの設定機能
- [ ] 修正前後の差分表示機能

## 変更履歴

### v1.2.0 (2026-02-12)
- ✅ ACマスターカードガイドライン完全統合（10項目チェックリスト対応）
- ✅ 禁止表現チェック強化（審査関連、ブラックリスト関連等）
- ✅ 必須指定表記の自動適用（審査時間、在籍確認、自動契約機）
- ✅ 最新レギュレーション対応（金利2.4%~17.9%、登録番号(15)）
- ✅ ステルスマーケティング表記の自動追加機能
- ✅ CTAリンク先の厳格なチェック

### v1.1.0 (2026-02-12)
- ✅ JCBガイドライン完全統合（14項目チェックリスト対応）
- ✅ 画像URL・リンクURL完全保持機能追加
- ✅ デフォルトガイドライン自動読み込み機能
- ✅ 詳細プロンプト設計（JCB専用）

### v1.0.0 (2026-02-12)
- ✅ 初回リリース
- ✅ 基本機能実装（認証、テキスト修正、HTML修正）
- ✅ OpenAI API統合

## 最終更新日

2026-02-12
